import React from 'react';
import ReactDOM from 'react-dom';

const baseURL = process.env.ENDPOINT;
console.log('Base URL:', baseURL);

const getWeatherFromApi = async () => {
  try {
    const response = await fetch(`${baseURL}/weather`);
    return response.json();
  } catch (error) {
    console.error('Error on trying to reach the endpoint', error);
    console.log('Error on trying to reach the endpoint', error);
  }

  return {};
};

const getForecast = async (lat, long) => {
  console.log('trying to fetch forecast');
  try {
    const response = await fetch(`${baseURL}/forecast?lat=${lat}&lon=${long}`);
    // .then((res) => res.json())
    // .then((data) => {
    //   // Process and set the data in your component state or context
    // });
    return response.json();
  } catch (error) {
    console.error(error);
  }
  return {};
};

class Weather extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      icon: '',
      forecast: [],
    };
  }

  async componentDidMount() {
    const weather = await getWeatherFromApi();
    this.setState({ icon: weather.icon.slice(0, -1) });

    // const forecastData = await getForecast(61.4917167, 23.7833776);
    const forecastData = await getForecast(23.7833776, 61.4917167);
    this.setState({ forecast: forecastData });
  }

  render() {
    console.log('hot reloading?');
    const { icon, forecast } = this.state;

    return (
      <div className="weather-app">
        <div className="icon">
          { icon && <img src={`/img/${icon}.svg`} alt="weather-icon" /> }
        </div>
        <div className="forecast">
          {forecast.map((entry, index) => (
            <div key={index}>
              {entry.dt_txt}
              :
              {' '}
              {entry.main.temp}
              Â°C
            </div>
          ))}
        </div>
      </div>
    );
  }
}

ReactDOM.render(
  <Weather />,
  document.getElementById('app'),
);
